/* font.c - 8x12 Font with Anti-aliasing */
#include <font.h>
#include <graphics.h>

/* 8x12 font - ASCII 32-127 */
static const uint8_t font_data[96][12] = {
    /* 32: Space */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    /* 33: ! */
    {0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x00,0x18,0x18,0x00,0x00},
    /* 34: " */
    {0x6C,0x6C,0x24,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    /* 35: # */
    {0x00,0x24,0x24,0x7E,0x24,0x24,0x7E,0x24,0x24,0x00,0x00,0x00},
    /* 36: $ */
    {0x10,0x3C,0x50,0x50,0x38,0x14,0x14,0x78,0x10,0x00,0x00,0x00},
    /* 37: % */
    {0x00,0x62,0x64,0x08,0x10,0x20,0x4C,0x8C,0x00,0x00,0x00,0x00},
    /* 38: & */
    {0x00,0x30,0x48,0x48,0x30,0x4A,0x44,0x44,0x3A,0x00,0x00,0x00},
    /* 39: ' */
    {0x18,0x18,0x08,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    /* 40: ( */
    {0x04,0x08,0x10,0x10,0x10,0x10,0x10,0x10,0x08,0x04,0x00,0x00},
    /* 41: ) */
    {0x20,0x10,0x08,0x08,0x08,0x08,0x08,0x08,0x10,0x20,0x00,0x00},
    /* 42: * */
    {0x00,0x00,0x24,0x18,0x7E,0x18,0x24,0x00,0x00,0x00,0x00,0x00},
    /* 43: + */
    {0x00,0x00,0x10,0x10,0x7C,0x10,0x10,0x00,0x00,0x00,0x00,0x00},
    /* 44: , */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x08,0x10,0x00},
    /* 45: - */
    {0x00,0x00,0x00,0x00,0x7E,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    /* 46: . */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00},
    /* 47: / */
    {0x02,0x04,0x04,0x08,0x10,0x10,0x20,0x40,0x40,0x80,0x00,0x00},
    /* 48: 0 */
    {0x3C,0x66,0x66,0x6E,0x76,0x66,0x66,0x66,0x3C,0x00,0x00,0x00},
    /* 49: 1 */
    {0x18,0x38,0x18,0x18,0x18,0x18,0x18,0x18,0x7E,0x00,0x00,0x00},
    /* 50: 2 */
    {0x3C,0x66,0x06,0x06,0x0C,0x18,0x30,0x60,0x7E,0x00,0x00,0x00},
    /* 51: 3 */
    {0x3C,0x66,0x06,0x06,0x1C,0x06,0x06,0x66,0x3C,0x00,0x00,0x00},
    /* 52: 4 */
    {0x0C,0x1C,0x2C,0x4C,0x8C,0xFE,0x0C,0x0C,0x0C,0x00,0x00,0x00},
    /* 53: 5 */
    {0x7E,0x60,0x60,0x7C,0x06,0x06,0x06,0x66,0x3C,0x00,0x00,0x00},
    /* 54: 6 */
    {0x1C,0x30,0x60,0x7C,0x66,0x66,0x66,0x66,0x3C,0x00,0x00,0x00},
    /* 55: 7 */
    {0x7E,0x06,0x06,0x0C,0x18,0x18,0x18,0x18,0x18,0x00,0x00,0x00},
    /* 56: 8 */
    {0x3C,0x66,0x66,0x66,0x3C,0x66,0x66,0x66,0x3C,0x00,0x00,0x00},
    /* 57: 9 */
    {0x3C,0x66,0x66,0x66,0x3E,0x06,0x06,0x0C,0x38,0x00,0x00,0x00},
    /* 58: : */
    {0x00,0x00,0x18,0x18,0x00,0x00,0x18,0x18,0x00,0x00,0x00,0x00},
    /* 59: ; */
    {0x00,0x00,0x18,0x18,0x00,0x00,0x18,0x18,0x08,0x10,0x00,0x00},
    /* 60: < */
    {0x00,0x06,0x0C,0x18,0x30,0x18,0x0C,0x06,0x00,0x00,0x00,0x00},
    /* 61: = */
    {0x00,0x00,0x00,0x7E,0x00,0x7E,0x00,0x00,0x00,0x00,0x00,0x00},
    /* 62: > */
    {0x00,0x60,0x30,0x18,0x0C,0x18,0x30,0x60,0x00,0x00,0x00,0x00},
    /* 63: ? */
    {0x3C,0x66,0x06,0x0C,0x18,0x18,0x00,0x18,0x18,0x00,0x00,0x00},
    /* 64: @ */
    {0x3C,0x66,0x6E,0x6A,0x6E,0x60,0x60,0x62,0x3C,0x00,0x00,0x00},
    /* 65: A */
    {0x18,0x3C,0x66,0x66,0x66,0x7E,0x66,0x66,0x66,0x00,0x00,0x00},
    /* 66: B */
    {0x7C,0x66,0x66,0x66,0x7C,0x66,0x66,0x66,0x7C,0x00,0x00,0x00},
    /* 67: C */
    {0x3C,0x66,0x60,0x60,0x60,0x60,0x60,0x66,0x3C,0x00,0x00,0x00},
    /* 68: D */
    {0x78,0x6C,0x66,0x66,0x66,0x66,0x66,0x6C,0x78,0x00,0x00,0x00},
    /* 69: E */
    {0x7E,0x60,0x60,0x60,0x7C,0x60,0x60,0x60,0x7E,0x00,0x00,0x00},
    /* 70: F */
    {0x7E,0x60,0x60,0x60,0x7C,0x60,0x60,0x60,0x60,0x00,0x00,0x00},
    /* 71: G */
    {0x3C,0x66,0x60,0x60,0x6E,0x66,0x66,0x66,0x3E,0x00,0x00,0x00},
    /* 72: H */
    {0x66,0x66,0x66,0x66,0x7E,0x66,0x66,0x66,0x66,0x00,0x00,0x00},
    /* 73: I */
    {0x3C,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x3C,0x00,0x00,0x00},
    /* 74: J */
    {0x0E,0x06,0x06,0x06,0x06,0x06,0x66,0x66,0x3C,0x00,0x00,0x00},
    /* 75: K */
    {0x66,0x6C,0x78,0x70,0x70,0x78,0x6C,0x66,0x66,0x00,0x00,0x00},
    /* 76: L */
    {0x60,0x60,0x60,0x60,0x60,0x60,0x60,0x60,0x7E,0x00,0x00,0x00},
    /* 77: M */
    {0xC6,0xEE,0xFE,0xD6,0xC6,0xC6,0xC6,0xC6,0xC6,0x00,0x00,0x00},
    /* 78: N */
    {0x66,0x76,0x7E,0x7E,0x6E,0x66,0x66,0x66,0x66,0x00,0x00,0x00},
    /* 79: O */
    {0x3C,0x66,0x66,0x66,0x66,0x66,0x66,0x66,0x3C,0x00,0x00,0x00},
    /* 80: P */
    {0x7C,0x66,0x66,0x66,0x7C,0x60,0x60,0x60,0x60,0x00,0x00,0x00},
    /* 81: Q */
    {0x3C,0x66,0x66,0x66,0x66,0x66,0x6A,0x6C,0x36,0x00,0x00,0x00},
    /* 82: R */
    {0x7C,0x66,0x66,0x66,0x7C,0x6C,0x66,0x66,0x66,0x00,0x00,0x00},
    /* 83: S */
    {0x3C,0x66,0x60,0x30,0x18,0x0C,0x06,0x66,0x3C,0x00,0x00,0x00},
    /* 84: T */
    {0x7E,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x00,0x00,0x00},
    /* 85: U */
    {0x66,0x66,0x66,0x66,0x66,0x66,0x66,0x66,0x3C,0x00,0x00,0x00},
    /* 86: V */
    {0x66,0x66,0x66,0x66,0x66,0x66,0x3C,0x3C,0x18,0x00,0x00,0x00},
    /* 87: W */
    {0xC6,0xC6,0xC6,0xC6,0xD6,0xFE,0xEE,0xC6,0xC6,0x00,0x00,0x00},
    /* 88: X */
    {0x66,0x66,0x3C,0x18,0x18,0x3C,0x66,0x66,0x66,0x00,0x00,0x00},
    /* 89: Y */
    {0x66,0x66,0x66,0x3C,0x18,0x18,0x18,0x18,0x18,0x00,0x00,0x00},
    /* 90: Z */
    {0x7E,0x06,0x0C,0x18,0x30,0x60,0x60,0x66,0x7E,0x00,0x00,0x00},
    /* 91: [ */
    {0x1E,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x1E,0x00,0x00,0x00},
    /* 92: \ */
    {0x80,0x40,0x40,0x20,0x10,0x10,0x08,0x04,0x04,0x02,0x00,0x00},
    /* 93: ] */
    {0x78,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x78,0x00,0x00,0x00},
    /* 94: ^ */
    {0x10,0x38,0x6C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    /* 95: _ */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0x00,0x00,0x00},
    /* 96: ` */
    {0x30,0x18,0x0C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    /* 97: a */
    {0x00,0x00,0x3C,0x06,0x3E,0x66,0x66,0x66,0x3E,0x00,0x00,0x00},
    /* 98: b */
    {0x60,0x60,0x7C,0x66,0x66,0x66,0x66,0x66,0x7C,0x00,0x00,0x00},
    /* 99: c */
    {0x00,0x00,0x3C,0x66,0x60,0x60,0x60,0x66,0x3C,0x00,0x00,0x00},
    /* 100: d */
    {0x06,0x06,0x3E,0x66,0x66,0x66,0x66,0x66,0x3E,0x00,0x00,0x00},
    /* 101: e */
    {0x00,0x00,0x3C,0x66,0x7E,0x60,0x60,0x66,0x3C,0x00,0x00,0x00},
    /* 102: f */
    {0x0E,0x18,0x18,0x7E,0x18,0x18,0x18,0x18,0x18,0x00,0x00,0x00},
    /* 103: g */
    {0x00,0x00,0x3E,0x66,0x66,0x66,0x3E,0x06,0x66,0x3C,0x00,0x00},
    /* 104: h */
    {0x60,0x60,0x7C,0x66,0x66,0x66,0x66,0x66,0x66,0x00,0x00,0x00},
    /* 105: i */
    {0x18,0x00,0x38,0x18,0x18,0x18,0x18,0x18,0x3C,0x00,0x00,0x00},
    /* 106: j */
    {0x06,0x00,0x0E,0x06,0x06,0x06,0x06,0x66,0x66,0x3C,0x00,0x00},
    /* 107: k */
    {0x60,0x60,0x66,0x6C,0x78,0x78,0x6C,0x66,0x66,0x00,0x00,0x00},
    /* 108: l */
    {0x38,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x3C,0x00,0x00,0x00},
    /* 109: m */
    {0x00,0x00,0xEC,0xFE,0xD6,0xD6,0xC6,0xC6,0xC6,0x00,0x00,0x00},
    /* 110: n */
    {0x00,0x00,0x7C,0x66,0x66,0x66,0x66,0x66,0x66,0x00,0x00,0x00},
    /* 111: o */
    {0x00,0x00,0x3C,0x66,0x66,0x66,0x66,0x66,0x3C,0x00,0x00,0x00},
    /* 112: p */
    {0x00,0x00,0x7C,0x66,0x66,0x66,0x7C,0x60,0x60,0x60,0x00,0x00},
    /* 113: q */
    {0x00,0x00,0x3E,0x66,0x66,0x66,0x3E,0x06,0x06,0x06,0x00,0x00},
    /* 114: r */
    {0x00,0x00,0x7C,0x66,0x60,0x60,0x60,0x60,0x60,0x00,0x00,0x00},
    /* 115: s */
    {0x00,0x00,0x3E,0x60,0x60,0x3C,0x06,0x06,0x7C,0x00,0x00,0x00},
    /* 116: t */
    {0x18,0x18,0x7E,0x18,0x18,0x18,0x18,0x18,0x0E,0x00,0x00,0x00},
    /* 117: u */
    {0x00,0x00,0x66,0x66,0x66,0x66,0x66,0x66,0x3E,0x00,0x00,0x00},
    /* 118: v */
    {0x00,0x00,0x66,0x66,0x66,0x66,0x3C,0x3C,0x18,0x00,0x00,0x00},
    /* 119: w */
    {0x00,0x00,0xC6,0xC6,0xD6,0xD6,0xFE,0xEE,0x44,0x00,0x00,0x00},
    /* 120: x */
    {0x00,0x00,0x66,0x66,0x3C,0x18,0x3C,0x66,0x66,0x00,0x00,0x00},
    /* 121: y */
    {0x00,0x00,0x66,0x66,0x66,0x66,0x3E,0x06,0x66,0x3C,0x00,0x00},
    /* 122: z */
    {0x00,0x00,0x7E,0x0C,0x18,0x30,0x60,0x66,0x7E,0x00,0x00,0x00},
    /* 123: { */
    {0x0C,0x18,0x18,0x18,0x30,0x18,0x18,0x18,0x0C,0x00,0x00,0x00},
    /* 124: | */
    {0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x00,0x00,0x00},
    /* 125: } */
    {0x30,0x18,0x18,0x18,0x0C,0x18,0x18,0x18,0x30,0x00,0x00,0x00},
    /* 126: ~ */
    {0x00,0x00,0x00,0x32,0x4C,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    /* 127: DEL (boş) */
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
};

/* Karakter çiz - anti-aliased kenarlarla */
void draw_char_aa(int x, int y, char c, uint32_t color, int scale) {
    int idx = (int)c - 32;
    if(idx < 0 || idx >= 96) idx = 0;

    /* Anti-alias rengi (yarı opaklık) */
    uint8_t r = ((color >> 16) & 0xFF) / 2;
    uint8_t g = ((color >> 8) & 0xFF) / 2;
    uint8_t b = (color & 0xFF) / 2;
    uint32_t aa_color = 0xFF000000 | (r << 16) | (g << 8) | b;

    /* Önce ana pikselleri çiz */
    for(int row = 0; row < 12; row++) {
        uint8_t line = font_data[idx][row];
        for(int col = 0; col < 8; col++) {
            if(line & (0x80 >> col)) {
                for(int sy = 0; sy < scale; sy++) {
                    for(int sx = 0; sx < scale; sx++) {
                        draw_pixel(x + col * scale + sx, y + row * scale + sy, color);
                    }
                }
            }
        }
    }

    /* Anti-aliasing: kenarları yumuşat */
    for(int row = 0; row < 12; row++) {
        uint8_t line = font_data[idx][row];
        uint8_t line_above = (row > 0) ? font_data[idx][row-1] : 0;
        uint8_t line_below = (row < 11) ? font_data[idx][row+1] : 0;

        for(int col = 0; col < 8; col++) {
            if(!(line & (0x80 >> col))) continue;

            /* Sol kenar */
            if(col > 0 && !(line & (0x80 >> (col-1)))) {
                for(int sy = 0; sy < scale; sy++) {
                    draw_pixel(x + col * scale - 1, y + row * scale + sy, aa_color);
                }
            }
            /* Sağ kenar */
            if(col < 7 && !(line & (0x80 >> (col+1)))) {
                for(int sy = 0; sy < scale; sy++) {
                    draw_pixel(x + (col + 1) * scale, y + row * scale + sy, aa_color);
                }
            }
            /* Üst kenar */
            if(!(line_above & (0x80 >> col))) {
                for(int sx = 0; sx < scale; sx++) {
                    draw_pixel(x + col * scale + sx, y + row * scale - 1, aa_color);
                }
            }
            /* Alt kenar */
            if(!(line_below & (0x80 >> col))) {
                for(int sx = 0; sx < scale; sx++) {
                    draw_pixel(x + col * scale + sx, y + (row + 1) * scale, aa_color);
                }
            }
        }
    }
}

/* String çiz */
void draw_string_aa(int x, int y, const char *str, uint32_t color, int scale) {
    int orig_x = x;
    while(*str) {
        if(*str == '\n') {
            x = orig_x;
            y += 12 * scale + 2;
        } else {
            draw_char_aa(x, y, *str, color, scale);
            x += 8 * scale;
        }
        str++;
    }
}

/* String genişliği */
int string_width_aa(const char *str, int scale) {
    int len = 0;
    while(*str) {
        if(*str != '\n') len++;
        str++;
    }
    return len * 8 * scale;
}
